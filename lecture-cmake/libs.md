## Статические и динамические библиотеки

### Что такое статические и динамические библиотеки?

- **Статическая библиотека** — это библиотека, которая встраивается в исполняемый файл на этапе компиляции. Это означает, что каждый исполняемый файл, использующий такую библиотеку, содержит свою копию кода библиотеки. Обычно статические библиотеки имеют расширение `.a` (в UNIX-системах) или `.lib` (в Windows).

- **Динамическая библиотека** — это библиотека, которая загружается в память только во время выполнения программы и может использоваться несколькими приложениями одновременно. Динамические библиотеки имеют расширение `.so` (Shared Object) в UNIX или `.dll` (Dynamic Link Library) в Windows.

### Основные различия

| Особенность             		| Статическая библиотека                          	| Динамическая библиотека                              	|
|-------------------------------|---------------------------------------------------|-------------------------------------------------------|
| **Встраивание**         		| Встраивается в программу на этапе компиляции   	| Загружается во время выполнения                     	|
| **Размер исполняемого файла** | Увеличивает размер исполняемого файла      		| Исполняемый файл содержит только ссылки на библиотеку |
| **Обновление**          		| Требуется перекомпиляция программы              	| Обновление библиотеки не требует перекомпиляции     	|
| **Использование памяти**		| У каждой программы своя копия                  	| Общая копия для всех программ, использующих библиотеку|

### Преимущества и недостатки

#### Преимущества статических библиотек:
- **Быстрое исполнение**: Все необходимые функции уже встроены в программу, что исключает время на загрузку.
- **Простота распространения**: Программе не нужны внешние зависимости на этапе выполнения, что может быть удобно для систем без поддержки динамических библиотек.

#### Недостатки статических библиотек:
- **Увеличение размера файла**: Так как каждый исполняемый файл имеет собственную копию библиотек, размер конечного файла может значительно вырасти.
- **Необходимость перекомпиляции**: При обновлении библиотеки нужно перекомпилировать программу, чтобы получить изменения.

#### Преимущества динамических библиотек:
- **Экономия памяти**: Память используется более эффективно, поскольку одна копия библиотеки может использоваться сразу несколькими программами.
- **Удобство обновления**: Обновление динамической библиотеки автоматически обновляет все программы, которые ее используют, без необходимости их перекомпилировать.

#### Недостатки динамических библиотек:
- **Возможность проблем совместимости**: Если обновленная версия библиотеки изменит API, это может нарушить работу программ, использующих эту библиотеку.
- **Может потребоваться установка дополнительных зависимостей**: Программа не будет работать, если в системе отсутствует нужная версия библиотеки.

---

## Использование команды `ldd` для проверки зависимостей

Команда `ldd` позволяет просматривать зависимости динамических библиотек программы, а также показывает пути к библиотекам и ошибки, если они не найдены.

```bash
ldd ./build/solution
```

Пример вывода:

```text
linux-vdso.so.1 (0x00007ffd84cfe000)
libparser.so => not found
libsolver.so => not found
libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007a93fc200000)
libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007a93fc5d2000)
libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007a93fbe00000)
libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007a93fc4e9000)
/lib64/ld-linux-x86-64.so.2 (0x00007a93fc627000)
```

- **libparser.so => not found** и **libsolver.so => not found** показывают, что система не смогла найти эти динамические библиотеки. Это может случиться, если они не установлены в системе или не указаны пути поиска.

### Вывод команды `ldd`

| Поле                | Значение |
|---------------------|----------|
| **linux-vdso.so.1** | Это виртуальная динамическая библиотека, используемая для улучшения производительности |
| **libparser.so** и **libsolver.so** | Не найдены, потому что не указаны пути или библиотек нет в системе |
| **libstdc++.so.6** | Путь к стандартной библиотеке C++ |
| **libm.so.6** | Математическая библиотека (необходима для выполнения математических операций) |
| **/lib64/ld-linux-x86-64.so.2** | Загрузчик динамических библиотек для Linux |

---

## Анализ символов в библиотеке и размера файла

Команда `nm` позволяет просматривать символы в библиотеке или исполняемом файле. Это полезно для анализа экспортируемых функций и переменных.

```bash
nm ./build/libsolver.so
nm ./build/libsolver.a
```

Вывод команды `nm` покажет символы, такие как функции и глобальные переменные, которые доступны в библиотеке.

### Сравнение размеров файлов

Для сравнения размеров файлов статической и динамической библиотек можно использовать команду `size`:

```bash
size ./build/libparser.a
size ./build/libparser.so
```

Также полезно посмотреть общий размер исполняемого файла с динамическими и статическими библиотеками (тут два файла проверять отдельно):

```bash
size ./build/solution
```


#### Пример вывода команды `size`:

```text
   text	   data	    bss	    dec	    hex	filename
  15434	    560	    704	  16728	   4148	./build/libparser.a
  11245	    412	    496	  12153	   2f69	./build/libparser.so
```

### Результаты сравнения

1. **Размеры файлов**: Обычно статические библиотеки занимают больше места, поскольку все функции компилируются в исполняемый файл. Динамические библиотеки могут иметь меньший размер, так как они подгружаются только при выполнении.

2. **Сравнение загруженных символов**: Команда `nm` на динамической библиотеке покажет экспортируемые символы, такие как функции и глобальные переменные. В случае со статической библиотекой эти символы будут встроены в исполняемый файл, и они не будут видны в самой библиотеке.

### Теоретический аспект: Потребление памяти

- **Статические библиотеки** создают копии всех своих символов для каждой программы, что увеличивает общий объем используемой памяти.
- **Динамические библиотеки** используют общую память для всех программ, что снижает потребление памяти, особенно если библиотека активно используется.

## Заключение

Работа со статическими и динамическими библиотеками дает разработчику гибкость в управлении памятью и удобством обновлений. Динамические библиотеки уменьшают объем памяти, но зависят от версии библиотек, установленных в системе, что может создать проблемы совместимости. Статические библиотеки, в свою очередь, создают независимость, но увеличивают размеры исполняемых файлов.

### Практика:

1. Используйте команду `ldd` для проверки зависимостей библиотеки в вашей системе.
2. Попробуйте скомпилировать проект со статической и динамической библиотеками и сравните размер итогового файла с помощью `size`.
3. Сравните список символов в статических и динамических версиях библиотеки с помощью `nm`.

Эти знания позволят вам уверенно управлять зависимостями и оптимизировать потребление ресурсов в C++ проектах.
```